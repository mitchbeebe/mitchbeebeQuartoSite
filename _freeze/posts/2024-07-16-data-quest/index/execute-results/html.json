{
  "hash": "d51451c96398c779d3f15aebdbb804b7",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Inaugural Mastery Quest - Summer Olympics\"\ndescription: \"Learn more on [Bletchley.org!](https://www.bletchley.org/blog/mastery-quest-the-summer-olympics-data-science)\"\ndate: \"2024-07-16\"\nimage: https://img.olympics.com/images/image/private/t_s_16_9_g_auto/t_s_w1460/f_auto/primary/ufimmifputd3kkkvdgmb\n---\n\n\nThis week's challenge was to find a dataset on the Summer Olympics and create a visualization, model, app, or other data-related output using the tool of your choice.\n\nI'll jump right to it and show my output.\n\n![It's widely known that the United States was in a Space Race with the Soviet Union throughout the Cold War, but it turns out we were also in a foot race. The USSR accumulated 1,005 golds, silvers, and bronzes starting in the 1952 Games in Helsinki through the 1988 Games in Seoul. The next closest countries were the USA and Germany with 957 and 755 medals tallied, respectively.](by-country.svg){fig-align=\"center\"}\n\n## How I Made It\n\nI started with the research question, *what countries have been the most dominant all-time?*\n\nTo start, I found this [data](https://www.kaggle.com/datasets/heesoo37/120-years-of-olympic-history-athletes-and-results/data) from an old Kaggle contest. In order to manipulate and visualize it, I'm loading the `tidyverse` of packages and the `emoji` package for fun graphics.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(emoji)\nlibrary(ggrepel)\nlibrary(ggtext)\nlibrary(ggimage)\n\nolympics <- readr::read_csv('athlete_events.csv') %>% rename_with(tolower)\nnoc <- readr::read_csv(\"noc_regions.csv\") %>% rename_with(tolower)\n```\n:::\n\n\nTaking a peek at the data, I can see it's one row per athlete per year per event. I also see it has the Winter Olympics included. I'll want to filter these out considering the Summer Olympics theme. I'll also need to count only one medal per event so team sports like basketball and relays don't skew the counts.\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n\nTable: {.striped .hover}\n\n| id|name                     |sex | age| height| weight|team           |noc |games       | year|season |city      |sport         |event                              |medal |\n|--:|:------------------------|:---|---:|------:|------:|:--------------|:---|:-----------|----:|:------|:---------|:-------------|:----------------------------------|:-----|\n|  1|A Dijiang                |M   |  24|    180|     80|China          |CHN |1992 Summer | 1992|Summer |Barcelona |Basketball    |Basketball Men's Basketball        |NA    |\n|  2|A Lamusi                 |M   |  23|    170|     60|China          |CHN |2012 Summer | 2012|Summer |London    |Judo          |Judo Men's Extra-Lightweight       |NA    |\n|  3|Gunnar Nielsen Aaby      |M   |  24|     NA|     NA|Denmark        |DEN |1920 Summer | 1920|Summer |Antwerpen |Football      |Football Men's Football            |NA    |\n|  4|Edgar Lindenau Aabye     |M   |  34|     NA|     NA|Denmark/Sweden |DEN |1900 Summer | 1900|Summer |Paris     |Tug-Of-War    |Tug-Of-War Men's Tug-Of-War        |Gold  |\n|  5|Christine Jacoba Aaftink |F   |  21|    185|     82|Netherlands    |NED |1988 Winter | 1988|Winter |Calgary   |Speed Skating |Speed Skating Women's 500 metres   |NA    |\n|  5|Christine Jacoba Aaftink |F   |  21|    185|     82|Netherlands    |NED |1988 Winter | 1988|Winter |Calgary   |Speed Skating |Speed Skating Women's 1,000 metres |NA    |\n\n\n:::\n:::\n\n\nI'd like to visualize cumulative medal counts by country to see if there are stretches of dominance. To do this, I'll need to aggregate the athlete-event data by country and year. I also need a reference table for the country flag emojis.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncumulative_medals <- \n  olympics %>% \n  left_join(\n    noc,\n    by = \"noc\"\n  ) %>% \n  filter(season == \"Summer\", !is.na(medal)) %>% \n  # Rename UK and USA for emoji match later\n  mutate(\n    team = case_when(\n      noc == \"GBR\" ~ \"United Kingdom\",\n      noc == \"USA\" ~ \"United States\",\n      TRUE ~ region\n    )\n  ) %>% \n  # Aggregate medals by country and year\n  group_by(team, year, medal) %>% \n  summarise(n = n_distinct(event), .groups = \"drop\") %>% \n  pivot_wider(names_from = medal, values_from = n, values_fill = 0) %>% \n  mutate(Total = Gold + Silver + Bronze) %>% \n  group_by(team) %>% \n  arrange(team, year) %>% \n  # Create a cumulative sum\n  mutate(across(Bronze:Total, ~ cumsum(replace_na(.x, 0))))\n\ncountry_flags <- \n  emojis %>% \n  filter(subgroup == \"country-flag\") %>% \n  mutate(country = str_extract(name, \"(?<=flag: ).*\"))\n```\n:::\n\n\nWith these aggregate tables, I'm ready to plot. See inline comments for detail.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nby_country <-\n  cumulative_medals %>% \n  # Only show countries with at least 500 total medals\n  filter(max(Total) >= 500) %>% \n  left_join(country_flags, by = c(\"team\" = \"country\")) %>% \n  group_by(team) %>% \n  # Only label the last year with the flag emoji to avoid noise\n  mutate(label = if_else(year == max(year), emoji, NA_character_)) %>% \n  ggplot(aes(x = year, y = Total)) + \n  # Highlight Russia/USSR in red during Cold War years\n  geom_line(\n    aes(\n      group = team,\n      color = if_else(\n        team == \"Russia\" & year >= 1947 & year <= 1991,\n        \"#FF3C28\",\n        \"grey60\"\n      )\n    )\n  ) +\n  scale_color_identity() +\n  geom_text_repel(\n    aes(label = label), \n    family = \"DIN Alternate\",\n    hjust = 0,\n    vjust = 0.5,\n    nudge_y = 15,\n    segment.size = 0.2,\n    xlim = c(2016, NA)\n  ) +\n  # Set ticks to years divisible by four to align with years in which Summer Games were held\n  scale_x_continuous(limits = c(1896, 2024), breaks = seq(1896, 2024, by = 16)) +\n  scale_y_continuous(\n    limits = c(0, 3000),\n    labels = scales::comma,\n    position = \"right\") +\n  labs(\n    title = \"<b>The Cold War: A Space Race or Foot Race?</b><br>The <span style='color: #ff3c28'>USSR<sup>1</sup></span> wins over 1,000 medals -- the most of any country in this period\",\n    subtitle = \"Cumulative Summer Olympics medal count by country for countries with at least 500 medals\",\n    x = NULL,\n    y = NULL,\n    caption = \"Data source: Kaggle<br><sup>1</sup> We lumped the USSR/Russia and Germany/East Germany together for this analysis\") +\n  # Add Cold War annotation\n  geom_errorbarh(\n    inherit.aes = FALSE,\n    data = tibble(xmin = 1947, xmax = 1991, y = 2600),\n    aes(xmin = xmin, xmax = xmax, y = y),\n    height = 100\n  ) +\n  annotate(\n    \"text\", x = 1969, y = 2700, \n    label = \"The Cold War (1947-1991)\", \n    family = \"DIN Alternate\",\n    hjust = 0.5, vjust = 0\n  ) +\n  theme_minimal() +\n  theme(\n    plot.title = element_markdown(margin = margin(l = 100, b = 5), vjust = 0.5),\n    plot.subtitle = element_markdown(margin = margin(l = 100, b = 10)),\n    plot.caption = element_markdown(),\n    text = element_text(family = \"DIN Alternate\"),\n    axis.line = element_line(color = \"grey20\"),\n    strip.text = element_text(size = 48)\n    )  +\n  coord_cartesian(clip = 'off') +\n  # Add Olympic Rings logo\n  annotation_custom(\n    magick::image_read(\"olympic_rings.svg\") %>% grid::rasterGrob(interpolate = TRUE), \n    x = 1890, xmax = 1914, y = 3300, ymax = 4100)\n\nggsave(by_country, file = \"by-country.svg\", width = 8, height = 4)\n```\n:::\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}