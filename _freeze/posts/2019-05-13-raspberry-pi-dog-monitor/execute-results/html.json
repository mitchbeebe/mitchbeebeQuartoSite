{
  "hash": "c2e77134dedd71443a93f2c7c983b782",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: Raspberry Pi Dog Monitor\ndate: '2019-05-13'\nslug: raspberry-pi-dog-monitor\ncategories:\n  - Python\n---\n\n\nCrate-training a puppy can be tough and a total surprise when you come home to find that they've torn up their bed, had an accident, or worse, broken free and vandalized your apartment. My dog, Harper, has done all three, but has since learned to love her cozy den. As I teased in my [\"Hello World\"](/posts/2019-05-07-hello_world/) post, I built a dog monitor using a Raspberry Pi to see what she was up to while I was gone. She didn't break out this time, but she was a bit mischievous.\n\n<br>\n\nThe hardware requirements for this project are a [Raspberry Pi](https://www.amazon.com/ELEMENT-Element14-Raspberry-Pi-Motherboard/dp/B07BDR5PDW/ref=sr_1_3?keywords=raspberry+pi+3&qid=1557794649&s=electronics&sr=1-3) and [camera](https://www.amazon.com/gp/product/B01ER2SKFS/ref=ppx_yo_dt_b_search_asin_title?ie=UTF8&psc=1). If you need help setting up the camera, [PyImageSearch](https://www.pyimagesearch.com/) is a great resource and can help you [set it up](https://www.pyimagesearch.com/2015/03/30/accessing-the-raspberry-pi-camera-with-opencv-and-python/). If you've never read it before, I highly recommend the blog. It has tons of posts and resources for learning OpenCV and applying deep learning computer vision techniques. It's where I caught the computer vision bug and found inspiration for several projects.\n\n<br>\n\nI still haven't figured out how to edit mp4/mov files into timelapse videos, so instead I took still photos at set time intervals and stitched them together into a gif with a brief delay. To do this, I used ImageMagick. On the Raspberry Pi, it was as simple as:\n\n``` bash\nsudo apt-get update\nsudo apt-get install imagemagick\n```\n\n<br>\n\nOnce I set up my RPi and camera, I switched over to Python. Below are the necessary packages for this project. Something worth calling out is that with the *smtplib* package, Gmail can get mad about \"less secure apps\" trying to sign in. Although not a good long-term solution, the workaround for this is to go into your Google security settings and allowing these apps.\n\n``` python\n# General use packages\nimport os\nimport time\nimport getpass\n# Packages needed for RPi Camera\nfrom picamera.array import PiRGBArray\nfrom picamera import PiCamera\n# Packages for emailing the video captured\nimport smtplib\nfrom email import encoders\nfrom email.mime.multipart import MIMEMultipart\nfrom email.mime.text import MIMEText\nfrom email.mime.base import MIMEBase\n```\n\n<br>\n\nNext, I set the email address from which I wanted to send the timelapse gif as well as the list of addresses to which I wanted to send it. I also initialized the SMTP connection and authenticated in this step.\n\n``` python\n# Set email address to send from,\n#   email address (list) to send to, and \n#   initialize SMTP connection to Gmail\nfromaddr = \"beebe.mitch@gmail.com\"\nemailTo = [\"beebe.mitch@gmail.com\"]\nserver = smtplib.SMTP('smtp.gmail.com', 587)\nserver.starttls()\nserver.login(fromaddr, getpass.getpass(\"Enter password: \"))\n```\n\n<br>\n\nNow that the email connection was set up, I cleared out any files associated with previous executions. I then initialized the RPi camera and begain taking still photos at 60 second intervals for 60 minutes \\* 4 hours, saving each photo in the same directory as image0000.jpg, image0001.jpg, image0002.jpg, and so on.\n\n``` python\n# Delete old gifs\nif os.path.isfile(\"harperMonitor.gif\"):\n    os.remove(\"harperMonitor.gif\")\n\n# Delete old jpg images saved\nfilelist = [ f for f in os.listdir(\".\") if f.endswith(\".jpg\") ]\nfor f in filelist:\n    os.remove(f)\n\n# Initialize camera\ncamera = PiCamera()\ncamera.resolution = (1024, 768)\n\n# Take a still jpg picture every minute for 4 hours\n#   and save image with 4-digit suffix with image index\nfor i in range(60*4):\n    camera.capture('image{0:04d}.jpg'.format(i))\n    time.sleep(60)\n```\n\n<br>\n\nWhen that loop finished, I then executed the code below from Python via the command line. Convert is a command from ImageMagick that allows you to manipulate image formats. I told it to convert every file with the .jpg extension into a gif with a tenth of a second delay between each image and no loop.\n\n``` python\n# Convert jpg to gif with 0.1 second delay\nos.system('convert -delay 10 -loop 0 image*.jpg harperMonitor.gif')\n```\n\n<br>\n\nNext, I initialized a `MIMEMultipart` message with proper to and from emails, subject, and body. Lastly, I opened the gif and attached it using the `MIMEImage` subclass. Now the email was ready to send and close the connection.\n\n``` python\n# Initialize a multipart email (one with body, attachments, etc) \nmsg = MIMEMultipart()\n\n# Add From, To, Subject, and Body of email\nmsg['From'] = fromaddr\nmsg['To'] = \", \".join(toaddr)\nmsg['Subject'] = \"Harper Monitor for \" + time.strftime(\"%m/%d/%y\")\nbody = \"Here is your daily Harper video! Woof.\"\nmsg.attach(MIMEText(body, 'plain'))\n\n# Attach the gif to the email\nfp = open(\"harperMonitor.gif\",\"rb\")\nmsgImg = MIMEImage(fp.read())\nfp.close()\nmsg.attach(msgImg)\n\n# Send the email and close the connection\nserver.sendmail(fromaddr, toaddr, msg.as_string())\nserver.quit()\n```\n\n<br>\n\nThat's it! It takes \\~ 4 hours to run (duh), but you can alter the frequency and number of images taken depending on how long Harper is in her crate. Below is a cropped version of the end result that I received in my Gmail inbox. Someone got ornery while I was away! Thanks for reading.\n\n<video width=\"100%\" controls>\n\n<source src=\"harper_crate.mov\" type=\"video/mp4\" align=\"center\" border=\"5\">\n\n</video>\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}